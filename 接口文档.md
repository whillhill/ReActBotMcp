# MCP Agent API 文档

## 1. 智能体推理与交互

### 1.1 /mcp
- 请求类型：POST
- 参数（JSON）:
  - query (str)
  - mode (str, 可选): "standard" | "react"
  - stream_type (str, 可选): null | "step" | "token"
  - include_trace (bool, 可选)
- 作用：统一LLM推理/工具调用入口，支持流式和非流式
- 预计返回：
  - 非流式：{"result": ...}
  - 流式：SSE流，data: {...}\n\n
- curl：
```bash
curl -X POST http://localhost:18200/mcp \
  -H "Content-Type: application/json" \
  -d '{"query": "你好，帮我查下天气", "mode": "react", "stream_type": null, "include_trace": false}'
```

---

## 2. 服务管理

### 2.1 /register
- 请求类型：POST
- 参数（JSON）:
  - url (str)
  - name (str, 可选)
- 作用：注册/重注册一个MCP服务
- 预计返回：{"status": "success", "message": ...}
- curl：
```bash
curl -X POST http://localhost:18200/register \
  -H "Content-Type: application/json" \
  -d '{"url": "http://127.0.0.1:8001", "name": "my-mcp"}'
```

### 2.2 /health
- 请求类型：GET
- 参数：无
- 作用：获取编排器和所有已注册服务的健康状态
- 预计返回：
```json
{
  "orchestrator_status": "running",
  "active_services": 1,
  "total_tools": 3,
  "services": [
    {"url": "...", "status": "healthy", ...}
  ]
}
```
- curl：
```bash
curl http://localhost:18200/health
```

### 2.3 /service_info
- 请求类型：GET
- 参数（Query）:
  - url (str)
- 作用：获取指定服务的详细信息
- 预计返回：
```json
{
  "url": "...",
  "status": "healthy",
  "tools": [
    {"name": "...", "description": "..."}
  ],
  ...
}
```
- curl：
```bash
curl "http://localhost:18200/service_info?url=http://127.0.0.1:8001"
```

### 2.4 /services
- 请求类型：GET
- 参数：无
- 作用：列出所有已注册服务
- 预计返回：{"services": [ ... ]}
- curl：
```bash
curl http://localhost:18200/services
```

---

## 3. 配置管理

### 3.1 /mcp_config
- 请求类型：GET
- 参数：无
- 作用：获取当前MCP配置
- 预计返回：{"mcpServers": { ... }}
- curl：
```bash
curl http://localhost:18200/mcp_config
```

### 3.2 /update_mcp_config
- 请求类型：POST
- 参数（JSON）:
  - mcpServers (dict)
- 作用：更新MCP配置并同步服务
- 预计返回：{"status": "...", "message": ...}
- curl：
```bash
curl -X POST http://localhost:18200/update_mcp_config \
  -H "Content-Type: application/json" \
  -d '{"mcpServers": {"my-mcp": {"url": "http://127.0.0.1:8001"}}}'
```

### 3.3 /register_mcp_services
- 请求类型：POST
- 参数：无
- 作用：批量注册配置文件中的所有服务
- 预计返回：{"status": "...", "message": ...}
- curl：
```bash
curl -X POST http://localhost:18200/register_mcp_services
```

### 3.4 /remove_service_from_config
- 请求类型：POST
- 参数（Query）:
  - url (str)
  - service_name (str, 可选)
- 作用：从配置中移除服务并断开连接
- 预计返回：{"status": "...", "message": ...}
- curl：
```bash
curl -X POST "http://localhost:18200/remove_service_from_config?url=http://127.0.0.1:8001&service_name=my-mcp"
```

---

## 4. 工具目录

### 4.1 /tools
- 请求类型：GET
- 参数：无
- 作用：列出所有可用工具
- 预计返回：{"tools": [ ... ]}
- curl：
```bash
curl http://localhost:18200/tools
```
